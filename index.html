<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Printing Service</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.paypal.com/sdk/js?client-id=AWlxRpEWuzvjdHyQ__cKpDgK7pj-qfWo8qGO9BkOlUq_TpiRoChpAdRWsuQp3TqDdH6R3iuql3LBWO_u&currency=GBP"></script>
<style>
body {
  background: radial-gradient(circle at center, #1b1b1b 0%, #000 100%);
  color: #fff;
  font-family: "Inter", sans-serif;
}
.glass-button {
  background: rgba(255,165,0,0.3);
  border: 1px solid rgba(255,165,0,0.5);
  border-radius: 1rem;
  padding: 0.75rem 1.5rem;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  text-align: center;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px rgba(255,165,0,0.7), 0 0 30px rgba(255,165,0,0.3);
}
.glass-button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(255,165,0,1), 0 0 50px rgba(255,165,0,0.5);
}
input, textarea, select {
  background: rgba(255,255,255,0.05);
  border-radius: 1rem;
  border: 1px solid rgba(255,255,255,0.2);
  padding: 0.75rem;
  color: #00f0ff;
  width: 100%;
  outline: none;
}
input::placeholder, textarea::placeholder { color:#00f0ff; opacity:0.7; }
.upload-box {
  border: 2px dashed rgba(255,165,0,0.5);
  border-radius: 1rem;
  padding: 2rem;
  text-align: center;
  cursor: pointer;
  color: #fff;
  font-weight: bold;
  box-shadow: 0 0 20px rgba(255,165,0,0.3);
  transition: all 0.3s ease;
}
.upload-box:hover { box-shadow: 0 0 40px rgba(255,165,0,0.6); }
</style>
</head>
<body class="min-h-screen flex justify-center p-6">
<div class="max-w-3xl w-full bg-[#111] rounded-3xl shadow-2xl p-8 space-y-8">

<header class="text-center space-y-4">
<img src="logo.png" alt="Mulbum3D logo" class="w-40 sm:w-48 mx-auto">
<h1 class="text-4xl font-extrabold tracking-tight text-orange-400">Professional 3D Printing</h1>
<p class="text-gray-400 text-lg">Fast, precise, and affordable custom 3D prints</p>
</header>

<div class="bg-[#1a1a1a] border border-[#333] rounded-xl p-4 text-center">
<p class="text-gray-400">Pricing:</p>
<p class="font-semibold text-white">£1 / hour machine time · £0.01 / gram PLA</p>
<p class="text-sm text-gray-500">Free shipping on orders over £50</p>
</div>

<section class="space-y-5">
<h2 class="text-2xl font-bold text-orange-400">Instant Cost Estimator</h2>
<div class="bg-[#1a1a1a] border rounded-xl p-5 space-y-2 shadow-sm">
<div class="flex justify-between"><span>Items</span><strong id="items-cost">£0.00</strong></div>
<div class="flex justify-between"><span>Shipping</span><strong id="shipping-cost">£0.00</strong></div>
<hr>
<div class="flex justify-between text-xl font-bold"><span>Total</span><span id="cost">£0.00</span></div>
</div>
</section>

<section class="space-y-4">
<h2 class="text-2xl font-bold text-orange-400">Customer Information</h2>
<input id="customer-name" type="text" placeholder="Full name" required>
<input id="postcode" type="text" placeholder="Postcode" required>
<textarea id="address" placeholder="House number, street, city" required></textarea>
</section>

<section class="space-y-3">
<h2 class="text-2xl font-bold text-orange-400">Upload Your 3D Model</h2>
<div class="upload-box">
<input id="model-upload" type="file" accept=".obj,.3mf,.amf" style="opacity:0;position:absolute;top:0;left:0;width:100%;height:100%;cursor:pointer;">
<span>Click or drag to upload (OBJ, 3MF, AMF · Max 8MB)</span>
</div>
</section>

<section class="space-y-3">
<h2 class="text-2xl font-bold text-orange-400">Select PLA Color</h2>
<select id="pla-color">
<option value="white">White</option>
<option value="black">Black</option>
<option value="red">Red</option>
<option value="blue">Blue</option>
<option value="green">Green</option>
</select>
<p class="text-sm text-gray-400 mt-2">Need multi-colored prints? Contact me via Gmail.</p>
</section>

<section class="space-y-3">
<h2 class="text-2xl font-bold text-orange-400">Secure Payment</h2>
<div id="paypal-button-container"></div>
<p id="payment-hint" class="text-sm text-gray-500">Upload a model to continue</p>
</section>

<footer class="text-center text-sm text-gray-500 pt-6 border-t border-[#333]">
© <span id="year"></span> 3D Printing Service · All rights reserved
</footer>
</div>

<script>
const HOURS_RATE = 1;
const PLA_RATE = 0.01;
let modelFile = null;
let currentCost = 0;
let currentShipping = 0;

const itemsCostEl = document.getElementById("items-cost");
const shippingCostEl = document.getElementById("shipping-cost");
const costEl = document.getElementById("cost");
const hintEl = document.getElementById("payment-hint");

function calculateShipping(weight) {
  if(weight * PLA_RATE >= 50) return 0;
  if(weight <= 250) return 2.99;
  if(weight <= 500) return 3.99;
  if(weight <= 1000) return 5.99;
  return 8.99;
}

function updateCost(sizeMB){
  const weight = sizeMB*50;
  const hours = sizeMB*2;
  const itemsCost = hours*HOURS_RATE + weight*PLA_RATE;
  currentShipping = itemsCost>=50?0:calculateShipping(weight);
  currentCost = itemsCost + currentShipping;
  itemsCostEl.textContent=`£${itemsCost.toFixed(2)}`;
  shippingCostEl.textContent=currentShipping===0&&itemsCost>=50?"FREE":`£${currentShipping.toFixed(2)}`;
  costEl.textContent=`£${currentCost.toFixed(2)}`;
  hintEl.style.display=currentCost>0?"none":"block";
}

document.getElementById('model-upload').addEventListener('change', e=>{
  if(e.target.files.length===0) return;
  const file = e.target.files[0];
  if(!file.name.match(/\.(obj|3mf|amf)$/i)){
    alert("Invalid file type. Only OBJ, 3MF, AMF allowed.");
    e.target.value="";
    return;
  }
  if(file.size>8*1024*1024){
    alert("File too large. Max 8MB for Discord upload.");
    e.target.value="";
    return;
  }
  modelFile = file;
  updateCost(modelFile.size/(1024*1024));
});

document.getElementById('year').textContent=new Date().getFullYear();

paypal.Buttons({
  createOrder:(data, actions)=>{
    if(!modelFile || currentCost<=0){alert('Upload a model first'); return;}
    return actions.order.create({purchase_units:[{description:'3D Printing Service',amount:{currency_code:'GBP',value:currentCost.toFixed(2)}}]});
  },
  onApprove:(data, actions)=>{
    if(!modelFile) return;
    const reader=new FileReader();
    reader.onload=function(){
      const fileContent=reader.result.split(",")[1];
      const payload={
        orderId:data.orderID,
        name:document.getElementById('customer-name').value,
        postcode:document.getElementById('postcode').value,
        address:document.getElementById('address').value,
        plaColor:document.getElementById('pla-color').value,
        fileName:modelFile.name,
        fileContent:fileContent,
        totalCost:currentCost.toFixed(2),
        payerEmail:data.payer.email_address
      };
      fetch('/.netlify/functions/logOrder',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)})
      .then(()=>alert('Payment complete! Order logged successfully.'))
      .catch(()=>alert('Payment succeeded but logging failed. Please contact support.'));
    };
    reader.readAsDataURL(modelFile);
  }
}).render('#paypal-button-container');
</script>
</body>
</html>
